<!DOCTYPE html>
<html lang="en">

  <head>
  	<title>Dublin Bikes</title>
    <meta charset="utf-8" name="viewport" content="initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/mycss.css') }}">
        <script src="static/javascript/chart.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  </head>

<!--Body----------------------------------------------------------------------------------->
<body>
<div class="header">
  <div class="col"><img src="/static/images/kilroy.png" alt="logo"></div>
    <div class="col">
        <a><img src="/static/images/db_logo_white.jpg"></a>
    	<a>Dublin Bikes</a>
    </div>
  <div class="col"><a class="current"></a></div>
  <div class="col"><a>&#8451</a></div>
</div>


<!--Navbar container------------------------------------------------------------------------->
	<div class="nav">
		<a href="index.html">Home</a>
		<a href="graph.html">Graph</a>
		<a href="details.html">Detail</a>
		<a href="contact.html">Contact</a>
	</div>

<!-------Side menu container------------------------------------------------------------------->
<div class="row">
  <div class="margin">
    <div class="dropdown">
      <p style="font-style:normal"><strong>Historical Charts & Predictions:</strong></p>
      <form id="selections" action="{{ url_for('graphs') }}" method = "POST">
           <!--<form id="radio" action="{{ url_for('graphs') }}" method = "POST">-->
      <input type='radio' name='radio' value='available_bikes' checked>Available bikes<br><br>
      <input type='radio' name='radio' value='available_bike_stands'>Available stands<br/>
        <br>
      <!--<input type="submit" value="submit!" />-->
    <!--<hr/>-->
        <select id='list' type="text" name="id" action="" method = "POST">
          <option value='108'>Avondale Road </option>
          <option value='70'>Barrow Street </option>
          <option value='90'>Benson Street </option>
          <option value='88'>Blackhall Place </option>
          <option value='2'>Blessington Street </option>
          <option value='3'>Bolton Street </option>
          <option value='84'>Brookfield Road </option>
          <option value='109'>Buckingham Street Lower </option>
          <option value='24'>Cathal Brugha Street </option>
          <option value='5'>Charlemont Street </option>
          <option value='107'>Charleville Road </option>
          <option value='6'>Christchurch Place </option>
          <option value='99'>City Quay </option>
          <option value='54'>Clonmel Street </option>
          <option value='87'>Collins Barracks Museum </option>
          <option value='65'>Convention Centre </option>
          <option value='23'>Custom House </option>
          <option value='8'>Custom House Quay </option>
          <option value='10'>Dame Street </option>
          <option value='59'>Denmark Street Great </option>
          <option value='45'>Deverell Place </option>
          <option value='11'>Earlsfort Terrace </option>
          <option value='12'>Eccles Street </option>
          <option value='79'>Eccles Street East </option>
          <option value='83'>Emmet Road </option>
          <option value='9'>Exchequer Street </option>
          <option value='48'>Excise Walk </option>
          <option value='63'>Fenian Street </option>
          <option value='89'>Fitzwilliam Square East </option>
          <option value='13'>Fitzwilliam Square West </option>
          <option value='14'>Fownes Street Upper </option>
          <option value='73'>Francis Street </option>
          <option value='98'>Frederick Street South </option>
          <option value='50'>George's Lane </option>
          <option value='16'>Georges Quay </option>
          <option value='17'>Golden Lane </option>
          <option value='69'>Grand Canal Dock </option>
          <option value='104'>Grangegorman Lower (Central) </option>
          <option value='105'>Grangegorman Lower (North) </option>
          <option value='103'>Grangegorman Lower (South) </option>
          <option value='18'>Grantham Street </option>
          <option value='57'>Grattan Street </option>
          <option value='4'>Greek Street </option>
          <option value='49'>Guild Street </option>
          <option value='68'>Hanover Quay </option>
          <option value='41'>Harcourt Terrace </option>
          <option value='61'>Hardwicke Place </option>
          <option value='15'>Hardwicke Street </option>
          <option value='55'>Hatch Street </option>
          <option value='19'>Herbert Place </option>
          <option value='47'>Herbert Street </option>
          <option value='92'>Heuston Bridge (North) </option>
          <option value='100'>Heuston Bridge (South) </option>
          <option value='94'>Heuston Station (Car Park) </option>
          <option value='93'>Heuston Station (Central) </option>
          <option value='7'>High Street </option>
          <option value='75'>James Street </option>
          <option value='40'>Jervis Street </option>
          <option value='72'>John Street West </option>
          <option value='71'>Kevin Street </option>
          <option value='115'>Killarney Street </option>
          <option value='97'>Kilmainham Gaol </option>
          <option value='96'>Kilmainham Lane </option>
          <option value='101'>King Street North </option>
          <option value='21'>Leinster Street South </option>
          <option value='62'>Lime Street </option>
          <option value='76'>Market Street South </option>
          <option value='78'>Mater Hospital </option>
          <option value='25'>Merrion Square East </option>
          <option value='113'>Merrion Square South </option>
          <option value='26'>Merrion Square West </option>
          <option value='27'>Molesworth Street </option>
          <option value='82'>Mount Brown </option>
          <option value='56'>Mount Street Lower </option>
          <option value='111'>Mountjoy Square East </option>
          <option value='28'>Mountjoy Square West </option>
          <option value='66'>New Central Bank </option>
          <option value='53'>Newman House </option>
          <option value='60'>North Circular Road </option>
          <option value='112'>North Circular Road (O'Connell's) </option>
          <option value='74'>Oliver Bond Street </option>
          <option value='29'>Ormond Quay Upper </option>
          <option value='86'>Parkgate Street </option>
          <option value='30'>Parnell Square North </option>
          <option value='31'>Parnell Street </option>
          <option value='32'>Pearse Street </option>
          <option value='110'>Phibsborough Road </option>
          <option value='34'>Portobello Harbour </option>
          <option value='43'>Portobello Road </option>
          <option value='33'>Princes Street / O'Connell Street </option>
          <option value='106'>Rathdown Road </option>
          <option value='85'>Rothe Abbey </option>
          <option value='95'>Royal Hospital </option>
          <option value='64'>Sandwith Street </option>
          <option value='58'>Sir Patrick's Dun </option>
          <option value='35'>Smithfield </option>
          <option value='42'>Smithfield North </option>
          <option value='91'>South Dock Road </option>
          <option value='81'>St. James Hospital (Central) </option>
          <option value='80'>St James Hospital (Luas) </option>
          <option value='36'>St. Stephen's Green East </option>
          <option value='37'>St. Stephen's Green South </option>
          <option value='46'>Strand Street Great </option>
          <option value='38'>Talbot Street </option>
          <option value='67'>The Point </option>
          <option value='22'>Townsend Street </option>
          <option value='44'>Upper Sherrard Street </option>
          <option value='102'>Western Way </option>
          <option value='77'>Wolfe Tone Street </option>
          <option value='39'>Wilton Terrace </option>
          <option value='114'>Wilton Terrace (Park) </option>
          <option value='52'>York Street East</option>
          <option value='51'>York Street West</option>
        </select>
		  	<br/>
    		<br/>
        <input type="submit" class="button" value="submit" onclick="dropdown()">

      </form>
    </div>

    <div id='extraDropdownInfo'>

    </div>
<!--Chart1------------------------------------------------------------------------------------->

    <canvas id="chart1" width="250" height="150"></canvas>
    <script>
       // bar chart data<br />
       var barData1 = {
       labels : [{% for item in times %}
                      "{{item}}",
                  {% endfor %}],
       datasets : [
          {
                fillColor: "rgba(151,187,205,0.2)",
                strokeColor: "rgba(151,187,205,1)",
                pointColor: "rgba(151,187,205,1)",
             data : [{% for item in qty %}
                          {{item}},
                        {% endfor %}]
          }
          ]
       }

       var mychart1 = document.getElementById("chart1").getContext("2d");
       steps = 4;
       max = 30;
       new Chart(mychart1).Bar(barData1, {
           scaleOverride: true,
           scaleSteps: steps,
           scaleStepWidth: Math.ceil(max / steps),
           scaleStartValue: 0,
           scaleShowVerticalLines: true,
           scaleShowGridLines: true,
           barShowStroke: true,
           scaleShowLabels: true
       });
    </script>


 <!--Chart2------------------------------------------------------------------------------------->

    <canvas id="chart2" width="250" height="150"></canvas>
    <script>
       // bar chart data<br />
       var barData2 = {
       labels : [{% for item in labels %}
                      "{{item}}",
                  {% endfor %}],
       datasets : [
          {
                fillColor: "rgba(151,187,205,0.2)",
                strokeColor: "rgba(151,187,205,1)",
                pointColor: "rgba(151,187,205,1)",
             data : [{% for item in day_values %}
                          {{item}},
                        {% endfor %}]
          }
          ]
       }

       var mychart2 = document.getElementById("chart2").getContext("2d");
       steps = 4;
       max = 35;
       new Chart(mychart2).Line(barData2, {
           scaleOverride: true,
           scaleSteps: steps,
           scaleStepWidth: Math.ceil(max / steps),
           scaleStartValue: 0,
           scaleShowVerticalLines: true,
           scaleShowGridLines: true,
           barShowStroke: true,
           scaleShowLabels: true
       });
    </script>

  </div>
<!--End Nav Container------------------------------------------------------------------------>

  <div class="column">
		<div id="map"></div>
  </div>
</div>

<!-- this is for the directions/geolocation -->
<!-- <div id="floating-panel">
  <b>Mode of Travel: </b>
  <select id="mode">
      <option>Select a Mode</option>
    <option value="DRIVING">Driving</option>
    <option value="WALKING">Walking</option>
    <option value="BICYCLING">Bicycling</option>
    <option value="TRANSIT">Transit</option>
  </select>
  </div> -->

<!---Map script------------------------------------------------------------------------------->
    <script>

      var map;

      function initMap() {
        var myLatLng = {lat: 53.348196, lng: -6.276942}
        // var directionsDisplay = new google.maps.DirectionsRenderer;
        // var directionsService = new google.maps.DirectionsService;
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 53.348196, lng: -6.276942},
          zoom: 13
        });
        // directionsDisplay.setMap(map);
        // calculateAndDisplayRoute(directionsService, directionsDisplay);
        // document.getElementById('mode').addEventListener('change', function() {
        //   calculateAndDisplayRoute(directionsService, directionsDisplay);
        // });
        //passing the markers and holiday list in from flask
        var markers = {{station_list | safe }};
        var holidaylist = {{holidaylist | safe }};
        //how you access the holiday list
        console.log(holidaylist[0]);
        var infoWindow = new google.maps.InfoWindow({})
        console.log(markers)
        var green = '/static/images/green-dot.png'
        var yellow = '/static/images/yellow-dot.png'
        var red = '/static/images/red-dot.png'

        // //code candis cant get to work - to create a second info window  
        // var youarehere = new google.maps.InfoWindow({
        //     content: 'you are here! - simulation',
        //     position: myLatLng,
        //     map: map
        // });

        //creating the markers based on occupancy
        for (var i = 0; i < markers.length; i++){
          var pos = new google.maps.LatLng(parseFloat(markers[i].latitude), parseFloat(markers[i].longitude));
          var currentIcon;
          var allstands = markers[i].available_bikes + markers[i].available_bike_stands
          if (markers[i].available_bikes/allstands >= 0.7) {
            currentIcon = green;
          }else if ((markers[i].available_bikes/allstands  >= 0.3) && (markers[i].available_bikes/allstands  < 0.7)) {
            currentIcon = yellow;
          }else if (markers[i].available_bikes/allstands  < 0.3) {
            currentIcon = red;
          }
          var marker = new google.maps.Marker({
            position: pos,
            map: map,
            icon: currentIcon,
            title: markers[i].name,
            animation: google.maps.Animation.DROP
          })
          marker.addListener('click', function() {
            map.setZoom(15);
            map.setCenter(marker.getPosition());
            document.getElementById('chart1').style.display="None"
            document.getElementById('chart2').style.display="None"
          });
          google.maps.event.addListener(
            marker,
            'click',
            (function(marker, i) {
              return function() {
                var contentString = markers[i].name + '<br>' + '<br>' +  'Number of bikes to ride: ' + markers[i].available_bikes
                + '<br>' + 'Number of bike stands empty: ' + markers[i].available_bike_stands + '<br>' +
                'Last updated: ' + markers[i].last_update;

                var sideContent = "<p>" + "<b>" + markers[i].address + "</b><br/><br/>"
                + "Available bikes: " + markers[i].available_bikes + "<br/>"
                + "Available stands: " + markers[i].available_bike_stands + "<br/>"
                + "Last updated: " + markers[i].last_update + "<br/>";

                if (markers[i].banking == 1) {
					        sideContent += "Card payments accepted: Yes";
                } else {
                  sideContent += "Card payments accepted: No";
                }

                sideContent += "</p>";
                infoWindow.setContent(contentString)
                infoWindow.open(map, marker)
                document.getElementById("extraDropdownInfo").innerHTML = sideContent;
              }
            })(marker, i)
          )
        }


        // // geolocation
        // if (navigator.geolocation) {
        //   navigator.geolocation.getCurrentPosition(function(position) {
        //     var geopos = {
        //       lat: position.coords.latitude,
        //       lng: position.coords.longitude
        //     };
        //     infoWindow.setPosition(geopos);
        //     infoWindow.setContent('you are here!');
        //     infoWindow.open(map);
        //     map.setCenter(geopos);
        //   }, function() {
        //     handleLocationError(true, infoWindow, map.getCenter());
        //   });
        // } else {
        //   // Browser doesn't support Geolocation
        //   handleLocationError(false, infoWindow, map.getCenter());
        // }

      

      
      //   //goes with the youarehere, function to display directions
      //   function calculateAndDisplayRoute(directionsService, directionsDisplay, geopos) {
      //   var selectedMode = document.getElementById('mode').value;
      //   directionsService.route({
      //     origin: pos,  // Haight.
      //     destination: myLatLng,  // Ocean Beach.
      //     // Note that Javascript allows us to access the constant
      //     // using square brackets and a string value as its
      //     // "property."
      //     travelMode: google.maps.TravelMode[selectedMode]
      //   }, function(response, status) {
      //     if (status == 'OK') {
      //       directionsDisplay.setDirections(response);
      //     } else {
      //       window.alert('Directions request failed due to ' + status);
      //     }
      //   });
      // }
    }


	/*--------------------station list script-----------------------------------------------------*/
	function dropdown() {
		var markers = {{station_list | safe}};
		var ddsel = document.getElementById("list");
		var selectedStation = ddsel.options[ddsel.selectedIndex].value;

		var radios = document.getElementById("radio");
		for (var i=0; i<radios.length; i++) {
			if (radio[i].checked) {
				var selectedRadio = radios[i].value;
			}
		}

    var extraInfo = "<p>"
		for (var i = 0; i < markers.length; i++) {
			var availableBikes = markers[i].available_bikes;
			var availableStands = markers[i].available_bike_stands;
			var stationNum = markers[i].number;
			var stationAddress = markers[i].address;
			var lastUpdate = markers[i].last_update;
			var cardPayment = markers[i].banking;

			if (selectedStation == stationNum) {
			extraInfo += "<b>" + stationAddress + "</b><br/><br/>"
			+ "Available bikes: " + availableBikes + "<br/>"
			+ "Available stands: " + availableStands + "<br/>"
			+ "Last updated: " + lastUpdate + "<br/>";

				if (cardPayment == 1) {
					extraInfo += "Card payments accepted: Yes";
				} else {
					extraInfo += "Card payments accepted: No";
				}
			}
		}
		extraInfo += "</p>"
		document.getElementById("extraDropdownInfo").innerHTML = extraInfo;
    }


    // //geolocation error function
    // function handleLocationError(browserHasGeolocation, infoWindow, geopos) {
    //     infoWindow.setPosition(geopos);
    //     infoWindow.setContent(browserHasGeolocation ?
    //                           'Error: The Geolocation service failed.' :
    //                           'Error: Your browser doesn\'t support geolocation.');
    //     infoWindow.open(map);
    //   }

    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCavW5Ssi8LxuHtrKVg2vmdVkmoEm_VbBg&callback=initMap"
      async defer></script>

<!--Weather Icon--------------------------------------------------------------------------------->

    <script>
        $.ajax({
        url: "http://api.openweathermap.org/data/2.5/weather?units=metric",
        jsonp: "callback",
        dataType: "jsonp",
        data: {
        id: "7778677",
        APPID: "f189dc2a9a2453baec98286f49d36183"
        },
        success: function( response ) {
        console.log( response ); // server response
        $('.current').html('<img src="http://openweathermap.org/img/w/' + response.weather[0].icon + '.png" />' + response.main.temp);
        }
        });
    </script>

 <!--Footer-------------------------------------------------------------------------------------->
<div class="footer">
    <p>Copyright &#169 Candis, Natasha and Martin 2019</p>
</div>

</body>
</html>
